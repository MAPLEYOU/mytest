## 1. 进程、线程、协程的区别和联系？

参考答案：

**a：什么是进程？**

进程一般由程序、数据集合和程序控制块(Program Control Block,简称PCB)三部分组成。

- 程序:用于描述进程要完成的功能，是控制进程执行的指令集;
- 数据集合:是程序在执行时所需要的数据和工作区;
- 程序控制块PCB:包含进程的描述信息和控制信息,是进程存在的唯一标志。

进程具有的特征:

- 动态性：进程是程序的一次执行过程，是临时的，有生命周期的，是动态产生，动态消亡的；
- 并发性：任何进程都可以同其他进程一起并发执行；
- 独立性：进程是系统进行资源分配和调度的一个独立单位。
- 结构性：进程由程序、数据和进程控制块三部分组成。

如何在linux环境下创建一个子进程：

在linux环境下使用操作系统提供的`fork`函数，来创建一个子进程。

```c
#include <unisted.h>
pid_t fork(void);
```

原理：

子进程会拷贝父进程的PCB,以及页表等结构，创建子进程完成后，子进程具有自己的进程虚拟地址空间，具有自己的页表结构。

参数：该函数没有参数。

返回值：

- 小于0：表示创建失败
- 等于0：返回给子进程
- 大于0：返回给父进程

**b：什么是线程？**

从进程角度：

- 线程是"一个进程内部的控制序列"
- 一切进程至少都有一个线程
- 线程在进程内部运行，本质在进程地址空间运行

从资源分配角度：

- 在Linux系统中，在CPU眼中，看到的PCB都要闭传统的进程更加轻量化。
- 透过进程虚拟地址空间，可以看到进程的大部分资源，将进程资源合理分配给每个执行流，就形成了线程执行流。

从内核角度：

- 在Linux系统中，线程被称之为轻量级进程，内核中也是创建了`struct task_struct` 结构体来描述线程，线程task_struct结构以当中的内存指针指向进程的虚拟空间。
- 线程之间独有：linux下每个线程都有自己独有的id、栈空间，一组寄存器、errno、信号屏蔽字。
- 线程之间共享：文件描述符表，信号的处理方式，当前进程工作目录，用户id和组id。

多线程：

在linux环境下使用操作系统提供的`pthread_create`函数，来创建一个子线程。

```cpp
#include <pthread.h>
int pthread_create(pthread_t *thread,const pthread_attr_t *attr,void *(*start_routine) (void *),void *arg);
```

原理：

在linux操作系统下，创建一个线程，其实在操作系统内核创建了一个轻量级进程，同样线程的PCB也是拷贝进程的PCB，但是线程PCB当中内核指针指向进程的虚拟地址空间。

参数：

- pthread_t *thread：该参数是一个出参，返回线程的标识符,注意标识符和前面提到的线程ID是两码事。
- const pthread_attr_t *attr：表示创建线程的属性，传入NULL，则表示使用默认属性。
- void *(*start_routine) (void *)：线程的入口函数，线程创建完毕之后，就是从该函数指针当中保存的函数地址开始运行，线程入口函数按照返回值为`void *`，参数为`void *`进程传递。
- void *arg：为线程入口函数传递参数，可以传递C/C++内置类型，也可以传递结构体，类的实例化指针，this指针等。

返回值：

- 小于0：创建失败
- 等于或大于0：创建成功

**c:什么是协程？**

协程，是一种比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是由程序所控制(也就是在用户态执行)。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。



## 2.多进程与多线程的优缺点？

参考答案：由浅到深的回答，先回答什么是进程->再回答什么是线程->谈谈代码当中如何创建一个子进程->代码当中如何创建一个子线程->谈谈多线程程序涉及的线程安全问题->谈谈多线程和多进程各自的优缺点。

多进程的优点：

- 由于各个进程都有自己进程虚拟地址空间，所以各个进程程序之间不会互相感染，运行稳定。
- 子进程崩溃不会影响父进程，反之，同理。
- 多个进程可以充分利用多核cpu，并行的运行，不用担心对程序结果造成二义性。

多进程的缺点：

- 由于进程的独立性，所以不同进程之间数据交换需要用到进程间通信。
- 创建一个子进程的开销要比创建一个线程的开销打，并且子进程占用的资源要比线程多。
- 子进程退出，需要父进程进行等待，否则会造成资源泄露。
- 多进程程序切换比多线程程序切换，操作系统耗费代价要大。

多线程的优点：

- 创建一个线程的开销小，程序占用资源小。
- 可以充分利用多核cpu，多线程程序中的线程可以并行运行，提高程序效率。

多线程的缺点：

- 代码难度增加。
- 程序健壮性降低了，一个线程的崩溃，可能会导致整个程序的崩溃。
- 有可能性能的损失，如果多个线程之间频繁的切换的开销大于业务执行的开销，则会对业务的性能有损失。
- 缺乏访问控制，线程不安全，多个线程并行执行在操作临界资源时候，可能会导致程序执行结果的二义性。

